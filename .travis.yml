sudo: required
dist: xenial
language: cpp

git:
  submodules: true

matrix:
  include:
  - os: linux
    compiler: gcc-7
    addons:
      apt:
        sources: ['ubuntu-toolchain-r-test']
        packages: ['g++-7', 'cmake', 'cmake-data', 'zlib1g-dev', 'libbz2-dev', 'libboost-dev', 'python', 'python-nose', 'python-jinja2', 'python-pip']
    install: export CXX="g++-7"
    env: CMAKE_ARGS="-DLAMBDA_NATIVE_BUILD=0"

  - os: linux
    compiler: gcc-8
    addons:
      apt:
        sources: ['ubuntu-toolchain-r-test']
        packages: ['g++-8', 'cmake', 'cmake-data', 'zlib1g-dev', 'libbz2-dev', 'libboost-dev', 'python', 'python-nose', 'python-jinja2', 'python-pip']
    install: export CXX="g++-8"
    env: CMAKE_ARGS="-DLAMBDA_NATIVE_BUILD=1"

  - os: linux
    compiler: gcc-9
    addons:
      apt:
        sources: ['ubuntu-toolchain-r-test']
        packages: ['g++-9', 'cmake', 'cmake-data', 'zlib1g-dev', 'libbz2-dev', 'libboost-dev', 'python', 'python-nose', 'python-jinja2', 'python-pip']
    install: export CXX="g++-9"
    env: CMAKE_ARGS="-DLAMBDA_NATIVE_BUILD=0 -DCMAKE_CXX_FLAGS=-std=c++2a"

  - os: osx
    osx_image: xcode10.1
    compiler: gcc-9
    install: export CXX="g++-9"
    env: CMAKE_ARGS="-DLAMBDA_FASTBUILD=1"

script:
  - mkdir -p build && cd build
  - cmake .. -DLAMBDA_COMPILE_THREADS=2 ${CMAKE_ARGS}
  - travis_wait make VERBOSE=1 # need to prefix with travis_wait because it might take > 10min
  - ctest .
